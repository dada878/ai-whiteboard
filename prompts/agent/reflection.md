<!-- 
====================
📍 使用位置 (Used In)
====================
- /app/api/ai-agent/stream-natural/route.ts (階段 4: 反思與重試策略)
  - Function: reflectNaturally() - Line 734-872
  - 在每次工具調用後執行，決定是否需要繼續搜尋
  
====================
🎯 功能說明 (Purpose)
====================
- 評估已收集的資訊是否充足
- 檢查圖探索的執行情況
- 決定是否需要繼續搜尋或探索
- 提供下一步行動建議

====================
🔧 相關變數 (Variables)
====================
- {{originalQuestion}} - 使用者的原始問題
- {{toolCount}} - 已使用的工具數量
- {{collectedInfo}} - 已收集的所有資訊
- {{foundNoteIds}} - 找到的便利貼 ID 列表
- {{exploredNotes}} - 已詳細探索的便利貼
- {{graphExplorationStatus}} - 圖探索狀況詳細分析

====================
🔄 決策輸出 (Decision Output)
====================
- 判斷資訊是否充足
- 建議是否繼續搜尋
- 指出需要探索的特定節點
- 使用自然語言表達思考過程

====================
⚠️ 注意事項 (Notes)
====================
- 此 prompt 目前在程式碼中還是硬編碼的
- 未來可改為使用 PromptService 載入
-->

# 反思分析 Prompt

請用自然的第一人稱思考方式反思：我收集的資訊是否足以回答使用者的問題？

## 反思要點

### 原始問題
使用者問：「{{originalQuestion}}」

### 已收集資訊
- 使用了 {{toolCount}} 個工具
- 收集到的資訊：
{{collectedInfo}}

## 📊 資訊分析

### 便利貼搜尋結果
- 找到的便利貼 ID：{{foundNoteIds}}
- 已詳細探索的便利貼：{{exploredNotes}}

### 🔗 圖探索狀況檢查
{{graphExplorationStatus}}

## 思考問題

1. **充分性評估**
   - 我找到的資訊是否能回答使用者的問題？
   - 資訊的完整度如何？

2. **確信度評估**
   - 我對這個答案有多確信？
   - 是否還有疑慮或不確定的地方？
   - 是否有需要多了解的資訊我還沒調查？

3. **圖探索檢查**
   - 我有沒有重複對同一個便利貼使用 get_note_by_id？（這是錯誤的）
   - 我有沒有對相鄰節點（connections 中的 noteId）使用 get_note_by_id？
   - 上面的「未探索」列表中有沒有值得探索的相鄰節點？

4. **下一步行動**
   - 我是否需要尋找更多資訊？
   - 如果需要搜尋，應該從哪些角度進行？

## 🔍 策略提醒

### 發散性搜尋
- 嘗試不同關鍵字、同義詞、相關概念
- 從多個角度理解問題

### 正確的圖探索
- 對 connections.incoming 和 connections.outgoing 中的**其他便利貼 ID** 使用 get_note_by_id
- 避免重複探索同一個便利貼

### 組合策略
- 搜尋新關鍵字的同時，探索未探索的相鄰節點
- 平衡廣度搜尋和深度探索

## 決策輸出

基於以上分析，我的決定是：
- [ ] 資訊充足，可以回答問題
- [ ] 需要繼續搜尋更多資訊
- [ ] 需要探索特定的相鄰節點

## 回答風格

請用自然的語氣回答，就像在思考一樣：
「我覺得...」「我認為...」「看起來...」「也許我還需要...」